
site=ogg
enclosure=clma
camera=fs02
telescope=2m0a
calibdates="20190327 20190326 20190325 20190324 20190323 20190322 20190321"
calibdates="20190328 20190320 20190319 20190318 20190317 20190316 20190315"



mindate="2019-03-01T00:00:00"
maxdate="2019-04-30T00:00:00"
sciencedates="20190327 20190326 20190325 20190324 20190323 20190322 20190321"


processedpath=/home/dharbeck/Software/banzai/testing/

if true; then
for date in $calibdates; do
    rawpath=/archive/engineering/$site/$camera/$date/raw

    biases=`ls $rawpath/*b00*`
    for file in $biases; do
        echo
        #banzai_reduce_individual_frame --no-bpm --processed-path $processedpath --fpack --db-address sqlite:///db/test.db --ignore-schedulability --filename $file
    done
    #banzai_stack_calibrations --ignore-schedulability --fpack  --db-address sqlite:///db/test.db --processed-path $processedpath --site $site --telescope $telescope --enclosure $enclosure --camera $camera --frame-type bias --min-date $mindate --max-date $maxdate

    darks=`ls $rawpath/*d00*`
    for file in $darks; do
      echo
      #banzai_reduce_individual_frame --no-bpm --processed-path $processedpath --fpack --db-address sqlite:///db/test.db --ignore-schedulability --filename $file
    done
    #banzai_stack_calibrations --ignore-schedulability --fpack  --db-address sqlite:///db/test.db --processed-path $processedpath --site $site --telescope $telescope --enclosure $enclosure --camera $camera --frame-type dark --min-date $mindate --max-date $maxdate

    flats=`ls $rawpath/*f00*`
    for file in $flats; do

     banzai_reduce_individual_frame --no-bpm --processed-path $processedpath --fpack --db-address sqlite:///db/test.db --ignore-schedulability --filename $file
    done
    banzai_stack_calibrations --ignore-schedulability --fpack  --db-address sqlite:///db/test.db --processed-path $processedpath --site $site --telescope $telescope --enclosure $enclosure --camera $camera --frame-type skyflat --min-date $mindate --max-date $maxdate

done



fi

for date in $sciencedates; do
    rawpath=/archive/engineering/$site/$camera/$date/raw

    images=`ls $rawpath/*e00*`

    for file in $images; do
     banzai_reduce_individual_frame --no-bpm --processed-path $processedpath --fpack --db-address sqlite:///db/test.db --ignore-schedulability --filename $file
    done
done

python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190321/processed/ testing/ogg/fs02/20190321/processed/ >spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190322/processed/ testing/ogg/fs02/20190322/processed/ >>spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190323/processed/ testing/ogg/fs02/20190323/processed/ >>spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190324/processed/ testing/ogg/fs02/20190324/processed/ >>spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190325/processed/ testing/ogg/fs02/20190325/processed/ >>spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190326/processed/ testing/ogg/fs02/20190326/processed/ >>spectral.txt
python testing/comparecagtalogs.py /archive/engineering/ogg/fs02/20190327/processed/ testing/ogg/fs02/20190327/processed/ >>spectral.txt
